# Websockets Chat Example by Nodejs

实现了一个简单的群聊功能，用来说明nodejs对websockets的实现。

采用了开源框架[ws](https://github.com/websockets/ws)，其配置使用可参见项目首页文档。

## ps：一点对websockets的想法

说白了，websockets就是一条保持在客户端和服务器之间的链接，建立连接后，双方都可以主动地发送消息，也都可以主动关闭这条链接。
在服务器和客户端之间交流方式目前来说了解到有两种：

- 发布-订阅模式
- 点对点模式

### 发布-订阅模式

服务端需要创建一个代理（broker），用来负责向客户端广播消息，服务端只要将信息发布到broker上，broker就会将这条消息广播到所有连接到broker上的客户端。
服务端可以创建不同的主题，给客户端的用户订阅，订阅了同一主题的用户都会收到这条广播。
服务端也可以通过broker将消息发送给特定用户，实现类似与点对点的模式。
> 发布-订阅模式主要是在spring的框架下实现的，自己的了解也仅限于spring框架范围

### 点对点模式

点对点模式更加直观，但实现起来，服务器端的代码可能稍微复杂一点。
服务端的代码要自己维护每一条与客户端的链接。向所有用户发送消息就只能依赖于遍历的方法了，但是向带个用户，或指定的任意个用户发送消息就容易了，方法也是遍历。
> 点对点模式主要是在nodejs的，感觉nodejs的灵活性更高，但是，一旦服务端代码逻辑比较复杂，js的代码维护起来相对困难一些，当然，这时对我们中新手来说。

### 事件驱动vs定时任务

传统的http链接，服务端只能接受客户端的request，然后response。而对于websockets，服务端也是可以主动向客户端发送数据的。
假设服务端有一条信息要推送给一个分组的所有人，要求每个人收到后给一个回执，服务端便不再向其推送这条信息了。
这些用户并不都是在线的，为了保证所有人都收到信息，现在有两种做法：

- 启动定时任务，直到所有人都接受到了，结束定时任务
- 用户上线时触发任务检查，查看其有没有未推送的消息，有就启动推送

个人感觉事件驱动稍微好一些，应该尽量避免使用定时任务，其相对来说可能更耗资源，且实时性也没有事件驱动的及时。